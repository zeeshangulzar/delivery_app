<script src="//maps.google.com/maps/api/js?key=AIzaSyBRXZRZ2D2sB0lqQhBDsm619tV471Y5zFw"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>

<script type="text/javascript">
var draw = false;
var first_lat, first_lon
var last_lat, last_lon;
handler = Gmaps.build('Google');
$(function() {
   handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      var Qatar = [
         {"lat":25.426063,"lng":51.181199}
      ];
      last_lat, last_lon;
      google.maps.event.addListener(handler.map.getServiceObject(),'click',function(event){
         if (draw == true)
         {
            if (last_lat == null)
            {
               first_lat = last_lat = event.latLng.lat();
               first_lon = last_lon = event.latLng.lng();
            }
            console.log("Lat: "+event.latLng.lat()+" "+", Lon: "+event.latLng.lng());
            handler.bounds.extendWith(handler.addPolygons(
               [
                  [
                     {lat:  last_lat, lng: last_lon},
                     {lat:  event.latLng.lat(), lng: event.latLng.lng()}
                  ]
               ],{ strokeColor: '#F90505'}
            ));
           last_lat = event.latLng.lat();
           last_lon = event.latLng.lng();
        }
      });
      handler.map.centerOn(Qatar);
      handler.fitMapToBounds();
      handler.getMap().setZoom(9);
   });
});
function save_polygons(){
   draw = !draw;
   document.getElementById("draw_btn").className = "btn btn-primary btn-sm"
   if (draw == false)
   {
      document.getElementById("draw_btn").className = "btn btn-info btn-sm"
      handler.bounds.extendWith(handler.addPolygons(
         [
            [
               {lat:  last_lat, lng: last_lon},
               {lat:  first_lat, lng: first_lon}
            ]
         ],{ strokeColor: '#F90505'}
      ));
      first_lat = first_lon = last_lat = last_lon = null;
   }
}
</script>

<div class="right_col" role="main">
  <div class="">
    <div class="page-title">
      <div class="title_left">
        <h3>Map</h3>
      </div>
        <button id="draw_btn" class="btn btn-info btn-sm" style="float: right;" onclick='save_polygons()'><i class="fa fa-pencil-square-o"></i></button>
      <div>
      </div>
      <div style='width: 1050px;'>
        <div id="map" style='width: 1050px; height: 500px;'></div>
      </div>
    </div>
  </div>
</div>
